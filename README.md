# MAPS

Mason-Alberta Phonetic Segmenter

[![DOI](https://zenodo.org/badge/703623203.svg)](https://zenodo.org/doi/10.5281/zenodo.10035627)

accompanying journal article: [https://doi.org/10.1515/phon-2024-0015](https://doi.org/10.1515/phon-2024-0015)

old arXiv pre-print of accomapnying paper: [https://arxiv.org/abs/2310.15425](https://arxiv.org/abs/2310.15425)

This tool is still in a pre-release stage and has not been tested against a variety of data types. We welcome you to use it for your own work and report any issues you encounter. It is currently a command-line-only utility.

At present, only a model for American English is provided. Future releases will include a training function to allow the model to be trained on new data. If you are working with data that is reasonably close to the phone set in American English, the aligner might still be useful for your needs.

**Note:** Audio files **must** be sampled at 16 kHz for the best quality alignment, at the moment. This may be addressed in future releases.

A small demo is viewable in the [demo_files folder](https://github.com/MasonPhonLab/MAPS/tree/main/demo_files).

# Running the aligner

The aligner is run using the `maps.py` file. A list of arguments to the aligner can be generated by running `python maps.py -h`, the output of which is reproduced below.

```
usage: maps.py [-h] --audio AUDIO --text TEXT --model MODEL --dict DICT [--interp {true,false}]
               [--rm-ensemble] [--sil {true,false}] [--quiet] [--check-variants] [--overwrite]
               [--ensemble-table]

Mason-Alberta Phonetic Segmenter (MAPS). Phonetically segments a file or files in a directory
given transcription(s) and a grapheme-to-phoneme dictionary. Passed in directories will be
processed at the top level only and will not be processed recursively. Arguments that take values
may use "=" or not. For example, both "--audio=s.wav" and "--audio s.wav" will work correctly.

options:
  -h, --help            show this help message and exit
  --audio AUDIO         A WAV file or a directory containing WAV files
  --text TEXT           A txt file with an orthographic transcription or a directory with such
                        files
  --model MODEL         A tf format TensorFlow model to use for alignment; if a folder with
                        multiple models is given, all models will be used for ensemble alignment
                        with confidence intervals
  --dict DICT           A grapheme-to-phoneme dictionary like the CMU Pronouncing Dictionary
  --interp {true,false}
                        Whether to use interpolation or not. Default is set to true
  --rm-ensemble         Flags the program to remove the intermediate TextGrids created during
                        ensemble alignment
  --sil {true,false}    Whether to add silences to beginning and end of transcription. Default is
                        set to true
  --quiet               Suppresses info messages when flag is present; does not accept a value
  --check-variants      Checks pronunciation variants in the dictionary. This is currently VERY
                        slow
  --overwrite           If flag is set, existing TextGrid files with the same stem as the WAV
                        files will be overwritten
  --ensemble-table      Flags program to write ensemble results to a table. Appends to a filename
                        based on path to the audio and the path to the model. You may need to
                        delete rows from previous runs if they are not needed.
```

# Required packages

The required package are listed in the `requirements.txt` file. They can be installed using `pip install -r requirements.txt`.

# Citation

If you use this package in your work, please cite the associated paper:

Kelley, M., Perry, S. & Tucker, B. (2024). The Mason-Alberta Phonetic Segmenter: a forced alignment system based on deep neural networks and interpolation. *Phonetica, 81*(5), 451-508. [https://doi.org/10.1515/phon-2024-0015](https://doi.org/10.1515/phon-2024-0015)
